var filter={};function refresh(t=0){t=buildFilter(),getData("/inventory/getDosG?"+$.param(t),doDosChart)}function buildFilter(){return filter.plant=$("#plant").val(),filter.chemical=$("#chemical").val(),filter}function doDosChart(t){(chartDiv=$("#chartDiv")).empty();let l={},o={};t.forEach(t=>{var e=`<div style="border:0px solid red" class="col-auto mb-2" ><div class="card shadow h-100" style='max-width: 180px !important;width: 160px'><div id="chrt${t.id}_${t.tblCip_Plants_id}"></div> <span class='text-small text-center'>${t.PlantName}<br>${t.DaysOfInventory} Days</span></div></div>`,e=(chartDiv.append(e),l[t.tblCip_Plants_id]=t.PlantName,$(`nme${t.id}_`+t.tblCip_Plants_id).html(t.PlantName),o[t.chemical_name]=1,barColor="#32B232",t.TodayQty=parseFloat(t.TodayQty),t.WarningQty=parseFloat(t.WarningQty),t.RedQty=parseFloat(t.RedQty),t.TodayQty<=t.WarningQty&&(barColor="#F5F500"),t.TodayQty<=t.RedQty&&(barColor="#CC0000"),[{type:"bar",name:"",y:[t.LogQty],x:[t.chemical_name],marker:{color:"#909090"}},{type:"bar",name:"TodayQty",showlegend:!1,y:[t.TodayQty],x:[t.chemical_name],marker:{color:barColor,opacity:1}}]),a={title:{text:t.chemical_name,font:{size:14,color:"#000000"}},xaxis:{showticklabels:!1},showlegend:!1,barmode:"overlay",width:160,height:200,margin:{t:40,b:40,l:45,r:45}};Plotly.newPlot(`chrt${t.id}_`+t.tblCip_Plants_id,e,a)}),plantKeys=Object.keys(l).sort(),o=Object.keys(o).sort(),$("#plant").find("option").remove(),$("#plant").append($("<option>",{value:"",text:"All"})),plantKeys.forEach(t=>{$("#plant").append($("<option>",{value:l[t],text:l[t]}))}),$('#plant option[value="'+filter.plant+'"]').attr("selected","selected"),$("#chemical").find("option").remove(),$("#chemical").append($("<option>",{value:"",text:"All"})),o.forEach(t=>{$("#chemical").append($("<option>",{value:t,text:t}))}),$('#chemical option[value="'+filter.chemical+'"]').attr("selected","selected")}$(function(){setupAjaxToken(),refresh(0),$("#plant").change(t=>{refresh(1)}),$("#chemical").change(t=>{refresh(1)})});
