var filter={};function refresh(e=0){e=buildFilter(),getData("/api/whistory?"+$.param(e),doHistoryTable)}function historyDetailFormatter(e,t,a){return`${e} <a style="margin-left:10px" href="#" class="historyDetail" data-cipid="${t.ID}" onclick="detailClick(this)"><i class="fas fa-lg fa-info-circle"></i></a>`}function detailClick(e){openCipDetail($(e).data("cipid"))}function buildFilter(){return filter.dateFrom=$("#dateFrom").val(),filter.dateTo=$("#dateTo").val(),filter.system=$("#system").val(),filter.plant=$("#plant").val(),filter.line=$("#line").val(),filter.object=$("#object").val(),filter.exception=$("#exception").val(),filter.api_token=API_TOKEN,filter}function cellExceptionStyle(e,t,a){return"TRUE"==e?{classes:"bg-red"}:{}}function doHistoryTable(e){let t={},a={},l={},o={},i=0,n=0,r=0;e.forEach(e=>{i+=parseFloat(e["Total Chemical Cost"]),n+=parseFloat(e.facility_cost),r+=parseFloat(e.total_cost),t[e["CIP System"]]=1,a[e["CIP Line"]]=1,l[e.Object]=1,o[e.Plant]=1}),$("#totchem").html("$"+i.toLocaleString()),$("#totfacility").html("$"+n.toLocaleString()),$("#tottot").html("$"+r.toLocaleString()),t=Object.keys(t).sort(),a=Object.keys(a).sort(),l=Object.keys(l).sort(),o=Object.keys(o).sort(),$("#plant").find("option").remove(),$("#plant").append($("<option>",{value:"",text:"All"})),o.forEach(e=>{$("#plant").append($("<option>",{value:e,text:e}))}),$('#plant option[value="'+filter.plant+'"]').attr("selected","selected"),$("#system").find("option").remove(),$("#system").append($("<option>",{value:"",text:"All"})),t.forEach(e=>{$("#system").append($("<option>",{value:e,text:e}))}),$('#system option[value="'+filter.system+'"]').attr("selected","selected"),$("#line").find("option").remove(),$("#line").append($("<option>",{value:"",text:"All"})),a.forEach(e=>{$("#line").append($("<option>",{value:e,text:e}))}),$('#line option[value="'+filter.line+'"]').attr("selected","selected"),$("#object").find("option").remove(),$("#object").append($("<option>",{value:"",text:"All"})),l.forEach(e=>{$("#object").append($("<option>",{value:e,text:e}))}),$('#object option[value="'+filter.object+'"]').attr("selected","selected"),$("#dtable").bootstrapTable("load",e)}$(function(){$("#dateFrom").val(moment().subtract(2,"weeks").format("YYYY-MM-DD")),$("#dateTo").val(moment().format("YYYY-MM-DD")),refresh(0),$("#dateFrom").change(e=>{refresh(1)}),$("#dateTo").change(e=>{refresh(1)}),$("#system").change(e=>{refresh(1)}),$("#line").change(e=>{refresh(1)}),$("#plant").change(e=>{refresh(1)}),$("#object").change(e=>{refresh(1)})});
