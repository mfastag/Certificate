var react=0;function refresh(t=0){t=t||buildFilter(),react=0,doExpPieChart(t),doExpTrend30Chart(t),doTotalsTrend30Chart(t)}function buildFilter(){return{a:1}}function doExpPieChart(t){let e=getData("/expDashPie?"+$.param(t)),o=[];e.labels.forEach(t=>{o.push(t)});t={labels:o,values:e.values,type:"pie",hole:.5,textinfo:"label+percent",textposition:"outside",automargin:!0};$("#chemcostexp").html("$"+e.chemCost.toLocaleString()),console.log("doExpPieChart",e),Plotly.newPlot("chart1_div",[t],{responsive:!1,showlegend:!1,height:190,autosize:!0,margin:{l:20,r:20,b:20,t:0,pad:0}}),doExpPieChartByCost(e),document.getElementById("chart1_div").on("plotly_click",function(t){console.log(t.points[0].x,t.points[0].y)})}function doExpPieChartByCost(t){let e=[],o=(t.labels.forEach(t=>{e.push(t)}),[]);t.costValues.forEach(t=>{o.push(t)});var a={labels:e,values:o,type:"pie",hole:.5,textinfo:"label+value",textposition:"outside",automargin:!0};console.log("doExpPieChartByCost",t),Plotly.newPlot("chart5_div",[a],{responsive:!1,showlegend:!1,height:190,autosize:!0,margin:{l:20,r:20,b:20,t:0,pad:0}}),document.getElementById("chart1_div").on("plotly_click",function(t){console.log(t.points[0].x,t.points[0].y)})}function doExpTrend30Chart(t){let e=getData("/expDashTrend?");var o={x:e.x,y:e.y,type:"scatter",automargin:!0},a={x:e.x,y:e.count,type:"bar",zeroline:!1,automargin:!0,yaxis:"y2",marker:{color:"rgba(148, 103, 189, 0.3)"}};Plotly.newPlot("chart2_div",[o,a],{responsive:!1,showlegend:!1,autosize:!0,height:260,margin:{l:40,r:60,b:50,t:20,pad:0},yaxis2:{title:"CIP Count",titlefont:{color:"rgb(148, 103, 189)"},tickfont:{color:"rgb(148, 103, 189)"},overlaying:"y",side:"right",showgrid:!1}}),$("#chemcost").html("$"+e.total.toLocaleString()),document.getElementById("chart2_div").on("plotly_click",function(t){console.log(t),console.log(t.points[0].x,t.points[0].y)})}function doTotalsTrend30Chart(t){let e=getData("/totalsDashTrend?"+$.param(t));var t={x:e.x,y:e.elec,type:"bar",name:"Electricity",automargin:!0},o={x:e.x,y:e.time,type:"bar",name:"Time",automargin:!0},a={x:e.x,y:e.material,type:"bar",name:"Material",automargin:!0},r={x:e.x,y:e.water,type:"bar",name:"Water",automargin:!0},n={x:e.x,y:e.chem,name:"Chemicals",type:"bar",automargin:!0},l={x:e.x,y:e.therm,name:"Thermal",type:"bar",automargin:!0};console.log("doTotalsTrend30Chart",e),$("#totcost").html("$"+e.totCost.toLocaleString()),$("#duration").html((e.duration/60).toFixed(0)+" hours"),Plotly.newPlot("chart3_div",[n,a,r,t,o,l],{responsive:!1,showlegend:!0,autosize:!0,height:260,config:{displayModeBar:0},barmode:"stack",margin:{l:40,r:40,b:50,t:20,pad:0}}),document.getElementById("chart3_div").on("plotly_click",function(t){console.log(t.points[0].x,t.points[0].y)})}$(function(){refresh(),$("#dateFrom").change(t=>{refresh()}),$("#dateTo").change(t=>{refresh()}),$("#system").change(t=>{refresh()}),$("#line").change(t=>{refresh()}),$("#object").change(t=>{refresh()}),$("#exception").change(t=>{refresh()})});var toHHMMSS=t=>{t=parseInt(t,10);return[Math.floor(t/3600),Math.floor(t/60)%60,t%60].map(t=>t<10?"0"+t:t).filter((t,e)=>"00"!==t||0<e).join(":")};function secondsToDhms(t){t=Number(t);var e=Math.floor(t/86400),o=Math.floor(t%86400/3600),a=Math.floor(t%3600/60);Math.floor(t%60);return(0<e?e+(1==e?" day, ":" days, "):"")+(0<o?o+(1==o?" hour, ":" hours, "):"")+(0<a?a+(1==a?" minute, ":" minutes "):"")}
