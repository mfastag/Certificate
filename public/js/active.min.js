function colorCB(e){e.forEach(e=>{e=`<div class="col-sm mb-2"><div class="no-gutters align-items-center font-weight-bold text-dark card shadow h-100 py-1" style="color:black !important; background-color: ${e.StatusColor}">${e.ColorReason}</div></div>`;$("#colors").append(e)})}function refresh(e=!1){filter=buildFilter();getData("/activeData?"+$.param(filter),activeCB);e&&setTimeout(function(){refresh(1)},3e4)}function titleClick(e){openCipDetail($(e).data("cipid"))}function buildFilter(){let e={a:1};return e.line=$("#line").val(),e.object=$("#object").val(),e.plant=$("#plant").val(),lnk=$.param({line:e.line,plant:e.plant,equipment:e.object}),$("#permlink").attr("href","/active?"+lnk),e}function activeCB(e){let i=[],n=[],l=[],o=[];e.forEach(e=>{id=e.PLC_Master_id,i.push(parseInt(id)),n[e.PLC_Name]=1,l[e.PlantName]=1,o[e.Cip_Line]=1,$("#card"+id).show(),$("#pretitle"+id).html(`${e.PlantName} - ${e.Cip_Line} - `+e.PLC_Name),$("#title"+id).html(""+e.GelType),$("#formula"+id).html(""+e.Formula_Batch_ID),$("#titlebar"+id).css("background-color",e.StatusColor),$("#stepname"+id).html(`Step: ${e.stepOrder} of ${e.maxSteps} - `+e.StepName),$("#steptime"+id).html(""+e.ProcessDate),$("#titlebar"+id).attr("data-cipid",""+e.tblSiteWideData_id);var t=(e.stepOrder/e.maxSteps*100).toFixed(0);$("#progress"+id).css("width",t+"%").attr("aria-valuenow",t).html(t+"%");let a="";0<e.DurationMin&&(e.DurationMin=parseInt(e.DurationMin),a+=`Duration: ${e.DurationMin} minutes<br>`),0<e.SetPoint&&(e.SetPoint=parseFloat(e.SetPoint).toFixed(2),a+=`Setpoint: ${e.SetPoint}<br>`),0<e.Acknowledge&&(a+="Acknowledge Required<br>"),$("#stepdet"+id).html(a)});for(let e=0;e<40;e++)i.includes(e)||$("#card"+e).hide();n=Object.keys(n).sort(),l=Object.keys(l).sort(),o=Object.keys(o).sort(),$("#object").find("option").remove(),$("#object").append($("<option>",{value:"",text:"All"})),n.forEach(e=>{$("#object").append($("<option>",{value:e,text:e}))}),$('#object option[value="'+filter.object+'"]').attr("selected","selected"),$("#plant").find("option").remove(),$("#plant").append($("<option>",{value:"",text:"All"})),l.forEach(e=>{$("#plant").append($("<option>",{value:e,text:e}))}),$('#plant option[value="'+filter.plant+'"]').attr("selected","selected"),$("#line").find("option").remove(),$("#line").append($("<option>",{value:"",text:"All"})),o.forEach(e=>{$("#line").append($("<option>",{value:e,text:e}))}),$('#line option[value="'+filter.line+'"]').attr("selected","selected")}$(function(){getData("/activeColors",colorCB),$("#system").change(e=>{refresh()}),$("#line").change(e=>{refresh()}),$("#object").change(e=>{refresh()}),$("#plant").change(e=>{refresh()}),params=getURLParameters(),console.log("params",params),params.plant&&$("#plant").append($("<option>",{value:params.plant,text:params.plant})),params.equipment&&$("#object").append($("<option>",{value:params.equipment,text:params.equipment})),params.line&&$("#line").append($("<option>",{value:params.line,text:params.line})),$("#line").val(params.line),$("#object").val(params.equipment),$("#plant").val(params.plant),refresh(1)});
